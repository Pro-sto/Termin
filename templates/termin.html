<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patientenanmeldung</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-blue-100 flex items-center justify-center h-screen">
    <div class="bg-white p-8 rounded-lg shadow-lg max-w-md w-full">
        <p class="text-blue-500 hover:text-blue-700 text-center" style="margin-top: 20px;">FÜLLEN SIE BITTE ALLE FELDER AUS</p>
        
        <div class="text-center mt-4 mb-4">
            <h3 class="text-lg">Öffnungszeiten:</h3>
            <p>Mo. - Fr.: 08:00 - 11:00 Uhr</p>
            <p>Mo. + Do.: 16:00 - 18:00 Uhr</p>
        </div>
        
        <form id="registrationForm" class="space-y-4" action="/termin" method="POST">
            <div>
                <label for="first_name" class="text-lg">Vorname:</label>
                <input type="text" id="first_name" name="first_name" required
                       class="w-full p-2 border border-gray-300 rounded mt-1">
            </div>
            <div>
                <label for="last_name" class="text-lg">Nachname:</label>
                <input type="text" id="last_name" name="last_name" required
                       class="w-full p-2 border border-gray-300 rounded mt-1">
            </div>
            <div>
                <label for="email" class="text-lg">E-Mail-Adresse:</label>
                <input type="email" id="email" name="email" required
                       class="w-full p-2 border border-gray-300 rounded mt-1">
            </div>
            <div>
                <label for="doctor" class="text-lg">Wählen Sie einen Arzt:</label>
                <select id="doctor" name="doctor" required
                        class="w-full p-2 border border-gray-300 rounded mt-1">
                    <option value="">Einen Arzt auswählen</option>
                    <option value="doctor1">Dr. Alice</option>
                    <option value="doctor2">Dr. Bob</option>
                </select>
            </div>
            <div>
                <label for="date" class="text-lg">Datum:</label>
                <input type="date" id="date" name="date" required
                       class="w-full p-2 border border-gray-300 rounded mt-1">
            </div>
            <div>
                <label for="time" class="text-lg">Uhrzeit:</label>
                <select id="time" name="time" required
                        class="w-full p-2 border border-gray-300 rounded mt-1">
                    <option value="">Uhrzeit wählen</option>
                    <!-- Time slots are generated by JavaScript -->
                </select>
            </div>
            <button type="submit" class="w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mt-4">
                Einreichen
            </button>
        </form>
        <div class="mt-4 text-center">
            <a href="http://127.0.0.1:8888/" class="text-blue-500 hover:text-blue-700">HOME</a>
        </div>
    </div>

    <script>
        // Функция для генерации временных слотов в соответствии с рабочими часами
        function generateWorkingHoursSlots(date) {
            const dayOfWeek = new Date(date).getDay();
            let times = [];
            
            // Понедельник (1) до Пятницы (5) с 8 до 11 утра
            if (dayOfWeek >= 1 && dayOfWeek <= 5) {
                for (let hour = 8; hour < 11; hour++) {
                    for (let minute = 0; minute < 60; minute += 20) {  // предполагаем интервал в 30 минут
                        times.push(`${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`);
                    }
                }
            }
    
            // Дополнительные вечерние часы для Понедельника (1) и Четверга (4) с 16 до 18
            if (dayOfWeek === 1 || dayOfWeek === 4) {
                for (let hour = 16; hour < 18; hour++) {
                    for (let minute = 0; minute < 60; minute += 20) {
                        times.push(`${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`);
                    }
                }
            }
    
            return times;
        }
    
        // Обработчик событий при изменении даты
        document.getElementById('date').addEventListener('change', function() {
            const date = this.value;
            const timeSelect = document.getElementById('time');
            timeSelect.innerHTML = ''; // Очистка предыдущих опций
            
            // Генерируем слоты времени согласно рабочему графику
            let workingHoursSlots = generateWorkingHoursSlots(date);
    
            fetch('/get_available_times', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({date: date})
            })
            .then(response => response.json())
            .then(data => {
                timeSelect.innerHTML = ''; // Очистить селект перед добавлением новых опций
                data.forEach(time => {
                    if (workingHoursSlots.includes(time)) { // Добавляем только те времена, которые в рабочем графике
                        let option = new Option(time, time);
                        timeSelect.add(option);
                    }
                });
                if (timeSelect.length === 0) {
                    let option = new Option("Нет доступных времен", "");
                    timeSelect.appendChild(option);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                timeSelect.innerHTML = '';
                let option = new Option("Ошибка загрузки времен", "");
                timeSelect.appendChild(option);
            });
        });
    
        // Обработчик событий при отправке формы
        document.getElementById('registrationForm').addEventListener('submit', function(event) {
            event.preventDefault();
            alert('Registrierung erfolgreich!');
            this.submit(); // Отправка формы после обработки
        });
    </script>
    
    
    
    
    
</body>
</html>
